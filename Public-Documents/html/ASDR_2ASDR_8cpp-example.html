<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ADL (AMD Display Library) Public APIs: ASDR/ASDR.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ASDR/ASDR.cpp</h1>A C/C++ Windows Service Sample Application for Windows (XP, Vista and above); 32bit and 64bit <br>
 Visual Studio 2015 solution file <b> "AMDServiceSampler.sln" </b> is included in ADL SDK<p>
<div class="fragment"><pre class="fragment">




<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;windows.h&gt;</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;process.h&gt;</span>
<span class="preprocessor">#include &lt;tchar.h&gt;</span>
<span class="preprocessor">#include &lt;atlbase.h&gt;</span>
<span class="preprocessor">#include "ASDR.h"</span>
<span class="preprocessor">#include &lt;WtsApi32.h&gt;</span>
<span class="preprocessor">#include "..\..\Include\GlobalDefines.h"</span>

<span class="preprocessor">#include "GetUserProcessData.h"</span>


<span class="preprocessor">#define AMDVENDORID             (1002)</span>
<span class="preprocessor"></span><span class="preprocessor">#define ADL_WARNING_NO_DATA      -100</span>
<span class="preprocessor"></span><span class="preprocessor">#define PRINTF printf</span>
<span class="preprocessor"></span>
<span class="keyword">using namespace </span>std;
<span class="preprocessor">#ifdef RUN_ADL_AS_SERVICE</span>
<span class="preprocessor"></span><span class="keyword">typedef</span> int(*ADL_MAIN_CONTROL_CREATE)(<a name="a0"></a><a class="code" href="adl__sdk_8h.html#f19f99637fc200b5324dd7e7561eecd1" title="Memory Allocation Call back.">ADL_MAIN_MALLOC_CALLBACK</a>, int);
<span class="keyword">typedef</span> int(*ADL_MAIN_CONTROL_DESTROY)();
<span class="keyword">typedef</span> int(*ADL_FLUSH_DRIVER_DATA)(int);
<span class="keyword">typedef</span> int(*ADL2_ADAPTER_ACTIVE_GET) (<a name="a1"></a><a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <span class="keywordtype">int</span>*);
<span class="keyword">typedef</span> int(*ADL_ADAPTER_NUMBEROFADAPTERS_GET) (<span class="keywordtype">int</span>*);
<span class="keyword">typedef</span> int(*ADL_ADAPTER_ADAPTERINFO_GET) (<a name="_a2"></a><a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">LPAdapterInfo</a>, int);
<span class="keyword">typedef</span> int(*ADL_ADAPTERX2_CAPS) (int, <span class="keywordtype">int</span>*);
<span class="keyword">typedef</span> int(*ADL2_MAIN_CONTROL_CREATE)                                                                  (<a class="code" href="adl__sdk_8h.html#f19f99637fc200b5324dd7e7561eecd1" title="Memory Allocation Call back.">ADL_MAIN_MALLOC_CALLBACK</a>, int, <a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVE_CAPS) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a> context, <span class="keywordtype">int</span> iAdapterIndex, <span class="keywordtype">int</span> * iSupported, <span class="keywordtype">int</span> * iEnabled, <span class="keywordtype">int</span> * iVersion);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_CAPABILITIESX2_GET)        (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a name="_a3"></a><a class="code" href="struct__ADLODNCapabilitiesX2.html" title="Structure containing information about Overdrive N capabilities.">ADLODNCapabilitiesX2</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_PERFORMANCESTATUS_GET) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a name="_a4"></a><a class="code" href="structADLODNPerformanceStatus.html">ADLODNPerformanceStatus</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_FANCONTROL_GET) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a name="_a5"></a><a class="code" href="structADLODNFanControl.html" title="Structure containing information about Overdrive N Fan Speed.">ADLODNFanControl</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_FANCONTROL_SET) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a class="code" href="structADLODNFanControl.html" title="Structure containing information about Overdrive N Fan Speed.">ADLODNFanControl</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_POWERLIMIT_GET) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a name="_a6"></a><a class="code" href="structADLODNPowerLimitSetting.html" title="Structure containing information about Overdrive N power limit.">ADLODNPowerLimitSetting</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_POWERLIMIT_SET) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a class="code" href="structADLODNPowerLimitSetting.html" title="Structure containing information about Overdrive N power limit.">ADLODNPowerLimitSetting</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_TEMPERATURE_GET) (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, int, <span class="keywordtype">int</span>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_SYSTEMCLOCKSX2_GET)        (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a name="_a7"></a><a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_SYSTEMCLOCKSX2_SET)        (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_MEMORYCLOCKSX2_GET)        (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a>*);
<span class="keyword">typedef</span> int(*ADL2_OVERDRIVEN_MEMORYCLOCKSX2_SET)        (<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a>, int, <a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a>*);
<span class="keyword">typedef</span> int(*PADL_DISPLAY_MVPUSTATUS_GET)(int, <a name="_a8"></a><a class="code" href="structADLMVPUStatus.html" title="Structure containing information about MultiVPU status.">ADLMVPUStatus</a>  *);
HINSTANCE hDLL;
ADL_MAIN_CONTROL_CREATE          <a name="a9"></a><a class="code" href="group__MAINAPI.html#gbd3262ed253d0f47e41a6983ed3645c9" title="Function to initialize the ADL interface. This function should be called first.">ADL_Main_Control_Create</a> = NULL;
ADL_MAIN_CONTROL_DESTROY         <a name="a10"></a><a class="code" href="group__MAINAPI.html#g6109d29a69f5e52c28f7e5ede0afb38c" title="Function to destroy ADL global pointers. This function should be called last.">ADL_Main_Control_Destroy</a> = NULL;
ADL_ADAPTER_NUMBEROFADAPTERS_GET <a name="a11"></a><a class="code" href="group__ADAPTER.html#g16c0a744d9bfba9db1030326715f78a1" title="Function to retrieve the number of OS-known adapters.">ADL_Adapter_NumberOfAdapters_Get</a> = NULL;
ADL_ADAPTER_ADAPTERINFO_GET      <a name="a12"></a><a class="code" href="group__ADAPTER.html#gd305c0548224ab4623e1b89965b14f6b" title="Retrieves all OS-known adapter information.">ADL_Adapter_AdapterInfo_Get</a> = NULL;
ADL_ADAPTERX2_CAPS <a name="a13"></a><a class="code" href="group__ADAPTER.html#g44854567c38efc7cbe94547327129036" title="Function to retrieve adapter caps information.">ADL_AdapterX2_Caps</a> = NULL;
ADL2_MAIN_CONTROL_CREATE                        <a name="a14"></a><a class="code" href="group__MAINAPI.html#g4f2f1b006fa2c4d22089876fb09aece7" title="Function to initialize the ADL2 interface and to obtain client&amp;#39;s context handle...">ADL2_Main_Control_Create</a> = NULL;
ADL2_ADAPTER_ACTIVE_GET                         <a name="a15"></a><a class="code" href="group__ADAPTER.html#gc2ac6c29a7cf441689cccad2b887729d" title="Function to determine if the adapter is active or not.">ADL2_Adapter_Active_Get</a> = NULL;
ADL2_OVERDRIVEN_CAPABILITIESX2_GET <a name="a16"></a><a class="code" href="group__OVERDRIVEN.html#g975905ed807528d61776d01d2845d7b5" title="Function to retrieve the OverdriveN capabilities.">ADL2_OverdriveN_CapabilitiesX2_Get</a> = NULL;
ADL2_OVERDRIVEN_SYSTEMCLOCKSX2_GET <a name="a17"></a><a class="code" href="group__OVERDRIVEN.html#g841e2f8aeebc29494e12571494b5d6bc" title="Function to retrieve the current GPU clocks settings.">ADL2_OverdriveN_SystemClocksX2_Get</a> = NULL;
ADL2_OVERDRIVEN_SYSTEMCLOCKSX2_SET <a name="a18"></a><a class="code" href="group__OVERDRIVEN.html#ge29a1d06c2beda899bdbfb4dc6707359" title="Function to sets the current GPU clocks settings.">ADL2_OverdriveN_SystemClocksX2_Set</a> = NULL;
ADL2_OVERDRIVEN_PERFORMANCESTATUS_GET <a name="a19"></a><a class="code" href="group__OVERDRIVEN.html#g532c1f2221aa402609e304500924e218" title="Function to retrieve the current OD performance status.">ADL2_OverdriveN_PerformanceStatus_Get</a> = NULL;
ADL2_OVERDRIVEN_FANCONTROL_GET <a name="a20"></a><a class="code" href="group__OVERDRIVEN.html#gf5d2a3bfce02cb7ec8ac0dbd1ecdc5b8" title="Function to retrieve the current Fan control settings.">ADL2_OverdriveN_FanControl_Get</a> = NULL;
ADL2_OVERDRIVEN_FANCONTROL_SET <a name="a21"></a><a class="code" href="group__OVERDRIVEN.html#gad4634656ebc96eca502dcbf7de0f2e9" title="Function to set the current Fan controls settings.">ADL2_OverdriveN_FanControl_Set</a> = NULL;
ADL2_OVERDRIVEN_POWERLIMIT_GET <a name="a22"></a><a class="code" href="group__OVERDRIVEN.html#gfeecd1a8d63358e57431ddc0f7df5185" title="Function to retrieve the current power limit settings.">ADL2_OverdriveN_PowerLimit_Get</a> = NULL;
ADL2_OVERDRIVEN_POWERLIMIT_SET <a name="a23"></a><a class="code" href="group__OVERDRIVEN.html#g8de7998dbd949b3b3202cc00a99a716d" title="Function to sets the current power limit settings.">ADL2_OverdriveN_PowerLimit_Set</a> = NULL;
ADL2_OVERDRIVEN_MEMORYCLOCKSX2_GET <a name="a24"></a><a class="code" href="group__OVERDRIVEN.html#ga141830b2e41239d07fdbd12226ce654" title="Function to retrieve the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Get</a> = NULL;
ADL2_OVERDRIVEN_MEMORYCLOCKSX2_SET <a name="a25"></a><a class="code" href="group__OVERDRIVEN.html#g7bae9d706448be46762a2dfe4f1b2e95" title="Function to sets the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Set</a> = NULL;
ADL2_OVERDRIVE_CAPS <a name="a26"></a><a class="code" href="group__OVERDRIVE5.html#g3e12920d3881003c83c31a3f9e36982b" title="Function to retrieve current power management capabilities.">ADL2_Overdrive_Caps</a> = NULL;
ADL2_OVERDRIVEN_TEMPERATURE_GET <a name="a27"></a><a class="code" href="group__OVERDRIVEN.html#ge8a4a87b95f8a1b6d39ac13661b8b321" title="Function to retrieve the current temperture.">ADL2_OverdriveN_Temperature_Get</a> = NULL;
PADL_DISPLAY_MVPUSTATUS_GET pADL_Display_MVPUStatus_Get;
<span class="keywordtype">void</span>* <a name="a28"></a><a class="code" href="adl__sdk_8h.html#d16f14718feefaa629b3b7601ac9fdeb">__stdcall</a> ADL_Main_Memory_Alloc(<span class="keywordtype">int</span> iSize)
{
    <span class="keywordtype">void</span>* lpBuffer = malloc(iSize);
    <span class="keywordflow">return</span> lpBuffer;
}
<span class="keywordtype">void</span> <a class="code" href="adl__sdk_8h.html#d16f14718feefaa629b3b7601ac9fdeb">__stdcall</a> ADL_Main_Memory_Free(<span class="keywordtype">void</span>** lpBuffer)
{
    <span class="keywordflow">if</span> (NULL != *lpBuffer)
    {
        free(*lpBuffer);
        *lpBuffer = NULL;
    }
}
<a class="code" href="adl__structures_8h.html#81b5ad958ff0093538e67865860ced65" title="Handle to ADL client context.">ADL_CONTEXT_HANDLE</a> context = NULL;
<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">LPAdapterInfo</a>   lpAdapterInfo = NULL;
<span class="keywordtype">int</span>  iNumberAdapters;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>HANDLE m_hGPUFanSettingEvent;
HANDLE m_hEXFanSettingEvent;
HANDLE hThread1 = NULL;
HANDLE hThread2 = NULL;
<span class="preprocessor">#define SHARED_FANSETTINGDATAEVENT "Global\\userfansettingdataevent"</span>
<span class="preprocessor"></span><span class="preprocessor">#define SHARED_FANSETTINGDATAEVENT_EX "Global\\userfansettingdataevent_EX"</span>
<span class="preprocessor"></span>
SERVICE_STATUS          ssStatus;       
SERVICE_STATUS_HANDLE   sshStatusHandle;
DWORD                   dwErr = 0;
BOOL                    bDebug = FALSE;
TCHAR                   szErr[256];
HANDLE  hServerStopEvent = NULL;
PROCESS_INFORMATION     processInfo;

DWORD WINAPI service_ctrl(DWORD dwControl, DWORD dwEventType, LPVOID lpEventData, LPVOID lpContext);
VOID WINAPI service_main(DWORD dwArgc, LPTSTR *lpszArgv);
VOID CmdInstallService();
LPTSTR GetLastErrorText(LPTSTR lpszBuf, DWORD dwSize);
BOOL CheckIsVista();
<span class="keywordtype">bool</span> bstop = 0;
BOOL IsVista = FALSE;

<span class="keywordtype">int</span> maxThermalControllerIndex = 0;

<span class="keywordtype">void</span> __cdecl main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    SERVICE_TABLE_ENTRY dispatchTable[] =
    {
       { TEXT(SZSERVICENAME), (LPSERVICE_MAIN_FUNCTION)service_main},
       { NULL, NULL}
    };

    <span class="keywordflow">if</span> ((argc &gt; 1) &amp;&amp;
        ((*argv[1] == <span class="charliteral">'-'</span>) || (*argv[1] == <span class="charliteral">'/'</span>)))
    {
        <span class="keywordflow">if</span> (_stricmp(<span class="stringliteral">"install"</span>, argv[1] + 1) == 0)
        {
            CmdInstallService();
        }
        <span class="keywordflow">else</span>
        {
            <span class="keywordflow">goto</span> dispatch;
        }
        exit(0);
    }

dispatch:
    <span class="keywordflow">if</span> (!StartServiceCtrlDispatcher(dispatchTable))
        AddToMessageLog(TEXT(<span class="stringliteral">"StartServiceCtrlDispatcher failed."</span>));
}

<span class="keywordtype">void</span> WINAPI service_main(DWORD dwArgc, LPTSTR *lpszArgv)
{

<span class="preprocessor">#ifdef _SERVICE_DEBUG</span>
<span class="preprocessor"></span>    <span class="keywordtype">bool</span> bSleep = <span class="keyword">true</span>;
    <span class="keywordflow">while</span> (bSleep)
        Sleep(200);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef RUN_ADL_AS_SERVICE</span>
<span class="preprocessor"></span>    Sleep(20000);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    DWORD drtn;


    sshStatusHandle = RegisterServiceCtrlHandlerEx(TEXT(SZSERVICENAME), service_ctrl, NULL);

    <span class="keywordflow">if</span> (!sshStatusHandle)
        <span class="keywordflow">goto</span> cleanup;

    ssStatus.dwServiceType = SERVICE_WIN32_OWN_PROCESS;
    ssStatus.dwServiceSpecificExitCode = 0;


    <span class="keywordflow">if</span> (!ReportStatusToSCMgr(
        SERVICE_START_PENDING, 
        NO_ERROR,              
        3000))                 
        <span class="keywordflow">goto</span> cleanup;

    hServerStopEvent = CreateEvent(
        NULL,    
        TRUE,    
        FALSE,   
        NULL);   

    <span class="keywordflow">if</span> (hServerStopEvent == NULL)
        <span class="keywordflow">goto</span> cleanup;


    IsVista = CheckIsVista();

    ServiceStart();
    <span class="keywordflow">if</span> (ReportStatusToSCMgr(SERVICE_RUNNING,       
        NO_ERROR,              
        0))                    
        drtn = WAIT_TIMEOUT;
<span class="preprocessor">#ifndef RUN_ADL_AS_SERVICE</span>
<span class="preprocessor"></span>    DWORD dwThreadId = 0;
    <span class="comment">// TODO: run user process </span>
    {
        <span class="comment">// Get all adapter info</span>
        ExADLAdapterInfo responseADLdata = ExADLAdapterInfo();
        responseADLdata.iAdapters = 0;
        GetUserProcessData&lt;ExADLAdapterInfo&gt;  getUserProcessData = GetUserProcessData&lt;ExADLAdapterInfo&gt;(ExADLAdapterInfo::GetFunctionName(), responseADLdata);
        ExADLAdapterInfo * responsePointADLdata = getUserProcessData.GetProcessData();
        <span class="keywordtype">int</span> nAdapter = responsePointADLdata-&gt;szData / <span class="keyword">sizeof</span>(<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a>);
        <span class="comment">// Read structure point after template structure </span>
        <a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a>* infos = (<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a>*)((INT64)responsePointADLdata + <span class="keyword">sizeof</span>(ExADLAdapterInfo));
        <span class="keywordtype">int</span> iDevice = 0;
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> loopi = 0; loopi &lt; nAdapter; loopi++)
        {
            <a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a> info = infos[loopi];
            <span class="comment">// Get over drive is enabled</span>
            ExADLOverdriveCaps exADLODCaps = ExADLOverdriveCaps();
            exADLODCaps.iAdapters = info.<a name="a29"></a><a class="code" href="structAdapterInfo.html#1cebd517a5310383f786a12b71cdd58d" title="The ADL index handle. One GPU may be associated with one or two index handles.">iAdapterIndex</a>;
            GetUserProcessData&lt;ExADLOverdriveCaps &gt;  getUserProcessCaps = GetUserProcessData&lt;ExADLOverdriveCaps &gt;(ExADLOverdriveCaps::GetFunctionName(), exADLODCaps);
            <span class="keywordflow">if</span> ((7 == exADLODCaps.iVersion) &amp;&amp; (<span class="keyword">true</span> == exADLODCaps.iSupported))
            {
                <span class="comment">// Get over drive capabilities ( if not wait please change  GetUserProcessData::GetUserProcessData INFINITE value</span>
                ExADLODNCapabilitiesX2 exCapabilities = ExADLODNCapabilitiesX2();
                exCapabilities.iAdapters = info.<a class="code" href="structAdapterInfo.html#1cebd517a5310383f786a12b71cdd58d" title="The ADL index handle. One GPU may be associated with one or two index handles.">iAdapterIndex</a>;;
                GetUserProcessData&lt;ExADLODNCapabilitiesX2&gt;  getCapabilities = GetUserProcessData&lt;ExADLODNCapabilitiesX2&gt;(ExADLODNCapabilitiesX2::GetFunctionName(), exCapabilities);
                <a class="code" href="struct__ADLODNCapabilitiesX2.html" title="Structure containing information about Overdrive N capabilities.">ADLODNCapabilitiesX2</a> ODNCapabilitiesX2 = exCapabilities.sODNCapabilitiesX2;

                <span class="comment">// Get over drive fan control </span>
                ExADLODNFanControl exADLdataFanControl = ExADLODNFanControl();
                exADLdataFanControl.iAdapters = info.<a class="code" href="structAdapterInfo.html#1cebd517a5310383f786a12b71cdd58d" title="The ADL index handle. One GPU may be associated with one or two index handles.">iAdapterIndex</a>;;
                GetUserProcessData&lt;ExADLODNFanControl&gt;  getDataFanControl = GetUserProcessData&lt;ExADLODNFanControl&gt;(ExADLODNFanControl::GetFunctionName(), exADLdataFanControl);
                <a class="code" href="structADLODNFanControl.html" title="Structure containing information about Overdrive N Fan Speed.">ADLODNFanControl</a> ODNFanControl = exADLdataFanControl.odNFanControl;
            }
        }
        <span class="keywordflow">if</span> (responsePointADLdata)
        {
            <span class="keyword">delete</span> responsePointADLdata;
            responsePointADLdata = NULL;
        }
    }

    <span class="keywordflow">while</span> (1)
    {
        drtn = WaitForSingleObject(hServerStopEvent, INFINITE);
        <span class="keywordflow">if</span> (WAIT_OBJECT_0 == drtn)
            <span class="keywordflow">break</span>;
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>cleanup:


    <span class="keywordflow">if</span> (sshStatusHandle)
        (VOID)ReportStatusToSCMgr(
            SERVICE_STOPPED,
            dwErr,
            0);
    <span class="keywordflow">if</span> (g_hTokenToCheck != NULL)
        CloseHandle(g_hTokenToCheck);


    <span class="keywordflow">return</span>;
}

DWORD WINAPI service_ctrl(DWORD dwControl, DWORD dwEventType, LPVOID lpEventData, LPVOID lpContext)
{
    <span class="keywordflow">switch</span> (dwControl)
    {
    <span class="keywordflow">case</span> SERVICE_CONTROL_STOP:
        ReportStatusToSCMgr(SERVICE_STOP_PENDING, NO_ERROR, 0);
        ServiceStop();
        <span class="keywordflow">return</span> 0;

    <span class="keywordflow">case</span> SERVICE_CONTROL_INTERROGATE:
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> SERVICE_CONTROL_SESSIONCHANGE:
        <span class="keywordflow">if</span> (dwEventType == WTS_SESSION_LOGON)
        {
            ServiceStart();
        }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">default</span>:
        <span class="keywordflow">break</span>;

    }

    ReportStatusToSCMgr(ssStatus.dwCurrentState, NO_ERROR, 0);
    <span class="keywordflow">return</span> 0;
}

BOOL ReportStatusToSCMgr(DWORD dwCurrentState,
    DWORD dwWin32ExitCode,
    DWORD dwWaitHint)
{
    <span class="keyword">static</span> DWORD dwCheckPoint = 1;
    BOOL fResult = TRUE;


    <span class="keywordflow">if</span> (!bDebug) <span class="comment">// when debugging we don't report to the SCM</span>
    {
        <span class="keywordflow">if</span> (dwCurrentState == SERVICE_START_PENDING)
            ssStatus.dwControlsAccepted = 0;
        <span class="keywordflow">else</span>
            ssStatus.dwControlsAccepted = SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_SESSIONCHANGE;

        ssStatus.dwCurrentState = dwCurrentState;
        ssStatus.dwWin32ExitCode = dwWin32ExitCode;
        ssStatus.dwWaitHint = dwWaitHint;

        <span class="keywordflow">if</span> ((dwCurrentState == SERVICE_RUNNING) ||
            (dwCurrentState == SERVICE_STOPPED))
            ssStatus.dwCheckPoint = 0;
        <span class="keywordflow">else</span>
            ssStatus.dwCheckPoint = dwCheckPoint++;


        <span class="comment">// Report the status of the service to the service control manager.</span>
        <span class="comment">//</span>
        <span class="keywordflow">if</span> (!(fResult = SetServiceStatus(sshStatusHandle, &amp;ssStatus)))
        {
            AddToMessageLog(TEXT(<span class="stringliteral">"SetServiceStatus"</span>));
        }
    }
    <span class="keywordflow">return</span> fResult;
}



VOID AddToMessageLog(LPTSTR lpszMsg)
{
    TCHAR szMsg[(<span class="keyword">sizeof</span>(SZSERVICENAME) / <span class="keyword">sizeof</span>(TCHAR)) + 100];
    HANDLE  hEventSource;
    LPTSTR  lpszStrings[2];

    <span class="keywordflow">if</span> (!bDebug)
    {
        dwErr = GetLastError();
        hEventSource = RegisterEventSource(NULL, TEXT(SZSERVICENAME));

        _stprintf_s(szMsg, (<span class="keyword">sizeof</span>(SZSERVICENAME) / <span class="keyword">sizeof</span>(TCHAR)) + 100, TEXT(<span class="stringliteral">"%s error: %d"</span>), TEXT(SZSERVICENAME), dwErr);
        lpszStrings[0] = szMsg;
        lpszStrings[1] = lpszMsg;

        <span class="keywordflow">if</span> (hEventSource != NULL)
        {
            ReportEvent(hEventSource, 
                EVENTLOG_ERROR_TYPE,  
                0,                    
                0,                    
                NULL,                 
                2,                    
                0,                    
                (LPCSTR*)lpszStrings, 
                NULL);                

            (VOID)DeregisterEventSource(hEventSource);
        }
    }
}


<span class="keywordtype">void</span> CmdInstallService()
{
    SC_HANDLE   schService;
    SC_HANDLE   schSCManager;

    TCHAR szPath[512];

    <span class="keywordflow">if</span> (GetModuleFileName(NULL, szPath, 512) == 0)
    {
        <span class="keywordflow">return</span>;
    }

    schSCManager = OpenSCManager(
        NULL,                  
        NULL,                  
        SC_MANAGER_CONNECT | SC_MANAGER_CREATE_SERVICE
    );
    <span class="keywordflow">if</span> (schSCManager)
    {
        schService = CreateService(
            schSCManager,               
            TEXT(SZSERVICENAME),        
            TEXT(SZSERVICEDISPLAYNAME), 
            SERVICE_QUERY_STATUS,       
            SERVICE_WIN32_OWN_PROCESS | SERVICE_INTERACTIVE_PROCESS,  
            SERVICE_AUTO_START,       
            SERVICE_ERROR_NORMAL,       
            szPath,                     
            NULL,                       
            NULL,                       
            TEXT(SZDEPENDENCIES),       
            NULL,                       
            NULL);                      

        <span class="keywordflow">if</span> (schService)
        {
            CloseServiceHandle(schService);
        }
        CloseServiceHandle(schSCManager);
    }

}




<span class="preprocessor">#ifdef RUN_ADL_AS_SERVICE</span>
<span class="preprocessor"></span><span class="keywordtype">int</span> initializeADL()
{

    hDLL = LoadLibrary(TEXT(<span class="stringliteral">"atiadlxx.dll"</span>));
    <span class="keywordflow">if</span> (hDLL == NULL)
    {
        hDLL = LoadLibrary(TEXT(<span class="stringliteral">"atiadlxy.dll"</span>));
    }
    <span class="keywordflow">if</span> (NULL == hDLL)
    {
        PRINTF(<span class="stringliteral">"Failed to load ADL library\n"</span>);
        <span class="keywordflow">return</span> FALSE;
    }
    <a class="code" href="group__MAINAPI.html#gbd3262ed253d0f47e41a6983ed3645c9" title="Function to initialize the ADL interface. This function should be called first.">ADL_Main_Control_Create</a> = (ADL_MAIN_CONTROL_CREATE)GetProcAddress(hDLL, <span class="stringliteral">"ADL_Main_Control_Create"</span>);
    <a class="code" href="group__MAINAPI.html#g6109d29a69f5e52c28f7e5ede0afb38c" title="Function to destroy ADL global pointers. This function should be called last.">ADL_Main_Control_Destroy</a> = (ADL_MAIN_CONTROL_DESTROY)GetProcAddress(hDLL, <span class="stringliteral">"ADL_Main_Control_Destroy"</span>);
    <a class="code" href="group__ADAPTER.html#g16c0a744d9bfba9db1030326715f78a1" title="Function to retrieve the number of OS-known adapters.">ADL_Adapter_NumberOfAdapters_Get</a> = (ADL_ADAPTER_NUMBEROFADAPTERS_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL_Adapter_NumberOfAdapters_Get"</span>);
    <a class="code" href="group__ADAPTER.html#gd305c0548224ab4623e1b89965b14f6b" title="Retrieves all OS-known adapter information.">ADL_Adapter_AdapterInfo_Get</a> = (ADL_ADAPTER_ADAPTERINFO_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL_Adapter_AdapterInfo_Get"</span>);
    <a class="code" href="group__ADAPTER.html#g44854567c38efc7cbe94547327129036" title="Function to retrieve adapter caps information.">ADL_AdapterX2_Caps</a> = (ADL_ADAPTERX2_CAPS)GetProcAddress(hDLL, <span class="stringliteral">"ADL_AdapterX2_Caps"</span>);
    <a class="code" href="group__MAINAPI.html#g4f2f1b006fa2c4d22089876fb09aece7" title="Function to initialize the ADL2 interface and to obtain client&amp;#39;s context handle...">ADL2_Main_Control_Create</a> = (ADL2_MAIN_CONTROL_CREATE)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_Main_Control_Create"</span>);
    <a class="code" href="group__ADAPTER.html#gc2ac6c29a7cf441689cccad2b887729d" title="Function to determine if the adapter is active or not.">ADL2_Adapter_Active_Get</a> = (ADL2_ADAPTER_ACTIVE_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_Adapter_Active_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#g975905ed807528d61776d01d2845d7b5" title="Function to retrieve the OverdriveN capabilities.">ADL2_OverdriveN_CapabilitiesX2_Get</a> = (ADL2_OVERDRIVEN_CAPABILITIESX2_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_CapabilitiesX2_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#g841e2f8aeebc29494e12571494b5d6bc" title="Function to retrieve the current GPU clocks settings.">ADL2_OverdriveN_SystemClocksX2_Get</a> = (ADL2_OVERDRIVEN_SYSTEMCLOCKSX2_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_SystemClocksX2_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#ge29a1d06c2beda899bdbfb4dc6707359" title="Function to sets the current GPU clocks settings.">ADL2_OverdriveN_SystemClocksX2_Set</a> = (ADL2_OVERDRIVEN_SYSTEMCLOCKSX2_SET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_SystemClocksX2_Set"</span>);
    <a class="code" href="group__OVERDRIVEN.html#ga141830b2e41239d07fdbd12226ce654" title="Function to retrieve the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Get</a> = (ADL2_OVERDRIVEN_MEMORYCLOCKSX2_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_MemoryClocksX2_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#g7bae9d706448be46762a2dfe4f1b2e95" title="Function to sets the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Set</a> = (ADL2_OVERDRIVEN_MEMORYCLOCKSX2_SET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_MemoryClocksX2_Set"</span>);
    <a class="code" href="group__OVERDRIVEN.html#g532c1f2221aa402609e304500924e218" title="Function to retrieve the current OD performance status.">ADL2_OverdriveN_PerformanceStatus_Get</a> = (ADL2_OVERDRIVEN_PERFORMANCESTATUS_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_PerformanceStatus_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#gf5d2a3bfce02cb7ec8ac0dbd1ecdc5b8" title="Function to retrieve the current Fan control settings.">ADL2_OverdriveN_FanControl_Get</a> = (ADL2_OVERDRIVEN_FANCONTROL_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_FanControl_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#gad4634656ebc96eca502dcbf7de0f2e9" title="Function to set the current Fan controls settings.">ADL2_OverdriveN_FanControl_Set</a> = (ADL2_OVERDRIVEN_FANCONTROL_SET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_FanControl_Set"</span>);
    <a class="code" href="group__OVERDRIVEN.html#gfeecd1a8d63358e57431ddc0f7df5185" title="Function to retrieve the current power limit settings.">ADL2_OverdriveN_PowerLimit_Get</a> = (ADL2_OVERDRIVEN_POWERLIMIT_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_PowerLimit_Get"</span>);
    <a class="code" href="group__OVERDRIVEN.html#g8de7998dbd949b3b3202cc00a99a716d" title="Function to sets the current power limit settings.">ADL2_OverdriveN_PowerLimit_Set</a> = (ADL2_OVERDRIVEN_POWERLIMIT_SET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_PowerLimit_Set"</span>);
    <a class="code" href="group__OVERDRIVEN.html#ge8a4a87b95f8a1b6d39ac13661b8b321" title="Function to retrieve the current temperture.">ADL2_OverdriveN_Temperature_Get</a> = (ADL2_OVERDRIVEN_TEMPERATURE_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_OverdriveN_Temperature_Get"</span>);
    <a class="code" href="group__OVERDRIVE5.html#g3e12920d3881003c83c31a3f9e36982b" title="Function to retrieve current power management capabilities.">ADL2_Overdrive_Caps</a> = (ADL2_OVERDRIVE_CAPS)GetProcAddress(hDLL, <span class="stringliteral">"ADL2_Overdrive_Caps"</span>);
    pADL_Display_MVPUStatus_Get = (PADL_DISPLAY_MVPUSTATUS_GET)GetProcAddress(hDLL, <span class="stringliteral">"ADL_Display_MVPUStatus_Get"</span>);
    <span class="keywordflow">if</span> (NULL == <a class="code" href="group__MAINAPI.html#gbd3262ed253d0f47e41a6983ed3645c9" title="Function to initialize the ADL interface. This function should be called first.">ADL_Main_Control_Create</a> ||
        NULL == <a class="code" href="group__MAINAPI.html#g6109d29a69f5e52c28f7e5ede0afb38c" title="Function to destroy ADL global pointers. This function should be called last.">ADL_Main_Control_Destroy</a> ||
        NULL == <a class="code" href="group__ADAPTER.html#g16c0a744d9bfba9db1030326715f78a1" title="Function to retrieve the number of OS-known adapters.">ADL_Adapter_NumberOfAdapters_Get</a> ||
        NULL == <a class="code" href="group__ADAPTER.html#gd305c0548224ab4623e1b89965b14f6b" title="Retrieves all OS-known adapter information.">ADL_Adapter_AdapterInfo_Get</a> ||
        NULL == <a class="code" href="group__ADAPTER.html#g44854567c38efc7cbe94547327129036" title="Function to retrieve adapter caps information.">ADL_AdapterX2_Caps</a> ||
        NULL == <a class="code" href="group__MAINAPI.html#g4f2f1b006fa2c4d22089876fb09aece7" title="Function to initialize the ADL2 interface and to obtain client&amp;#39;s context handle...">ADL2_Main_Control_Create</a> ||
        NULL == <a class="code" href="group__ADAPTER.html#gc2ac6c29a7cf441689cccad2b887729d" title="Function to determine if the adapter is active or not.">ADL2_Adapter_Active_Get</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#g975905ed807528d61776d01d2845d7b5" title="Function to retrieve the OverdriveN capabilities.">ADL2_OverdriveN_CapabilitiesX2_Get</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#g841e2f8aeebc29494e12571494b5d6bc" title="Function to retrieve the current GPU clocks settings.">ADL2_OverdriveN_SystemClocksX2_Get</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#ge29a1d06c2beda899bdbfb4dc6707359" title="Function to sets the current GPU clocks settings.">ADL2_OverdriveN_SystemClocksX2_Set</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#ga141830b2e41239d07fdbd12226ce654" title="Function to retrieve the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Get</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#g7bae9d706448be46762a2dfe4f1b2e95" title="Function to sets the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Set</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#g532c1f2221aa402609e304500924e218" title="Function to retrieve the current OD performance status.">ADL2_OverdriveN_PerformanceStatus_Get</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#gf5d2a3bfce02cb7ec8ac0dbd1ecdc5b8" title="Function to retrieve the current Fan control settings.">ADL2_OverdriveN_FanControl_Get</a> ||
        NULL == <a class="code" href="group__OVERDRIVEN.html#gad4634656ebc96eca502dcbf7de0f2e9" title="Function to set the current Fan controls settings.">ADL2_OverdriveN_FanControl_Set</a> ||
        NULL == <a class="code" href="group__OVERDRIVE5.html#g3e12920d3881003c83c31a3f9e36982b" title="Function to retrieve current power management capabilities.">ADL2_Overdrive_Caps</a> ||
        NULL == pADL_Display_MVPUStatus_Get
        )
    {
        PRINTF(<span class="stringliteral">"Failed to get ADL function pointers\n"</span>);
        <span class="keywordflow">return</span> FALSE;
    }
    <span class="keywordflow">if</span> (<a name="a30"></a><a class="code" href="group__define__adl__results.html#g29dfbfcc4a3b9092febd107586668a75" title="ADL function completed successfully.">ADL_OK</a> != <a class="code" href="group__MAINAPI.html#gbd3262ed253d0f47e41a6983ed3645c9" title="Function to initialize the ADL interface. This function should be called first.">ADL_Main_Control_Create</a>(ADL_Main_Memory_Alloc, 1))
    {
        printf(<span class="stringliteral">"Failed to initialize nested ADL2 context"</span>);
        <span class="keywordflow">return</span> <a name="a31"></a><a class="code" href="group__define__adl__results.html#g917345ca58ec6b4d7c73865fdb611fd7" title="Generic Error. Most likely one or more of the Escape calls to the driver failed!">ADL_ERR</a>;
    }
    <span class="keywordflow">return</span> TRUE;
}
<span class="keywordtype">void</span> deinitializeADL()
{
    <a class="code" href="group__MAINAPI.html#g6109d29a69f5e52c28f7e5ede0afb38c" title="Function to destroy ADL global pointers. This function should be called last.">ADL_Main_Control_Destroy</a>();
    FreeLibrary(hDLL);
}
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>VOID ServiceStart()
{
<span class="preprocessor">#ifdef RUN_ADL_AS_SERVICE</span>
<span class="preprocessor"></span>    initializeADL();
    <span class="keywordtype">int</span> iReturn;
    <span class="keywordtype">int</span>  i, active = 0;;
    <span class="keywordtype">int</span> iSupported, iEnabled, iVersion;
    <span class="keywordtype">int</span>  iNumberAdapters = 0;
    <span class="keywordflow">if</span> (<a class="code" href="group__define__adl__results.html#g29dfbfcc4a3b9092febd107586668a75" title="ADL function completed successfully.">ADL_OK</a> != <a class="code" href="group__MAINAPI.html#g4f2f1b006fa2c4d22089876fb09aece7" title="Function to initialize the ADL2 interface and to obtain client&amp;#39;s context handle...">ADL2_Main_Control_Create</a>(ADL_Main_Memory_Alloc, 1, &amp;context))
    {
        printf(<span class="stringliteral">"Failed to initialize ADL2 context"</span>);
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">if</span> (<a class="code" href="group__define__adl__results.html#g29dfbfcc4a3b9092febd107586668a75" title="ADL function completed successfully.">ADL_OK</a> != <a class="code" href="group__ADAPTER.html#g16c0a744d9bfba9db1030326715f78a1" title="Function to retrieve the number of OS-known adapters.">ADL_Adapter_NumberOfAdapters_Get</a>(&amp;iNumberAdapters))
    {
        <span class="keywordflow">return</span>;
    }
    iReturn = <a class="code" href="group__ADAPTER.html#g16c0a744d9bfba9db1030326715f78a1" title="Function to retrieve the number of OS-known adapters.">ADL_Adapter_NumberOfAdapters_Get</a>(&amp;iNumberAdapters);
    <span class="keywordflow">if</span> (0 &lt; iNumberAdapters)
    {
        lpAdapterInfo = (<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">LPAdapterInfo</a>)malloc(<span class="keyword">sizeof</span>(<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a>) * iNumberAdapters);
        memset(lpAdapterInfo, <span class="charliteral">'\0'</span>, <span class="keyword">sizeof</span>(<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a>) * iNumberAdapters);
        iReturn = <a class="code" href="group__ADAPTER.html#gd305c0548224ab4623e1b89965b14f6b" title="Retrieves all OS-known adapter information.">ADL_Adapter_AdapterInfo_Get</a>(lpAdapterInfo, <span class="keyword">sizeof</span>(<a class="code" href="structAdapterInfo.html" title="Structure containing information about the graphics adapter.">AdapterInfo</a>) * iNumberAdapters);
    }
    <span class="keywordflow">for</span> (i = 0; i &lt; iNumberAdapters; i++)
    {
        <a class="code" href="structADLODNFanControl.html" title="Structure containing information about Overdrive N Fan Speed.">ADLODNFanControl</a> odNFanControl;
        memset(&amp;odNFanControl, 0, <span class="keyword">sizeof</span>(<a class="code" href="structADLODNFanControl.html" title="Structure containing information about Overdrive N Fan Speed.">ADLODNFanControl</a>));
        iReturn = <a class="code" href="group__OVERDRIVEN.html#gf5d2a3bfce02cb7ec8ac0dbd1ecdc5b8" title="Function to retrieve the current Fan control settings.">ADL2_OverdriveN_FanControl_Get</a>(context, lpAdapterInfo[i].iAdapterIndex, &amp;odNFanControl);
        <span class="keywordflow">if</span> (<a class="code" href="group__define__adl__results.html#g29dfbfcc4a3b9092febd107586668a75" title="ADL function completed successfully.">ADL_OK</a> != <a class="code" href="group__OVERDRIVEN.html#gf5d2a3bfce02cb7ec8ac0dbd1ecdc5b8" title="Function to retrieve the current Fan control settings.">ADL2_OverdriveN_FanControl_Get</a>(context, lpAdapterInfo[i].iAdapterIndex, &amp;odNFanControl))
        {
            PRINTF(<span class="stringliteral">"ADL2_OverdriveN_FanControl_Get is failed\n"</span>);
        }
        <a class="code" href="struct__ADLODNCapabilitiesX2.html" title="Structure containing information about Overdrive N capabilities.">ADLODNCapabilitiesX2</a> overdriveCapabilities;
        memset(&amp;overdriveCapabilities, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct__ADLODNCapabilitiesX2.html" title="Structure containing information about Overdrive N capabilities.">ADLODNCapabilitiesX2</a>));
        iReturn = <a class="code" href="group__OVERDRIVEN.html#g975905ed807528d61776d01d2845d7b5" title="Function to retrieve the OverdriveN capabilities.">ADL2_OverdriveN_CapabilitiesX2_Get</a>(context, lpAdapterInfo[i].iAdapterIndex, &amp;overdriveCapabilities);
        <a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a> *odPerformanceLevels;
        <span class="keywordtype">int</span> size = <span class="keyword">sizeof</span>(<a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a>) + <span class="keyword">sizeof</span>(<a name="_a32"></a><a class="code" href="structADLODNPerformanceLevelX2.html" title="Structure containing information about Overdrive level.">ADLODNPerformanceLevelX2</a>)* (overdriveCapabilities.<a name="a33"></a><a class="code" href="struct__ADLODNCapabilitiesX2.html#05acc64089a06ce6ccce380b071bde3c">iMaximumNumberOfPerformanceLevels</a> - 1);
        <span class="keywordtype">void</span>* performanceLevelsBuffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[size];
        memset(performanceLevelsBuffer, 0, size);
        odPerformanceLevels = (<a class="code" href="structADLODNPerformanceLevelsX2.html" title="Structure containing information about Overdrive N performance levels.">ADLODNPerformanceLevelsX2</a>*)performanceLevelsBuffer;
        odPerformanceLevels-&gt;<a name="a34"></a><a class="code" href="structADLODNPerformanceLevelsX2.html#73e5a9a756f4c9afa832fa1b32bfdbb6">iSize</a> = size;
        odPerformanceLevels-&gt;<a name="a35"></a><a class="code" href="structADLODNPerformanceLevelsX2.html#0f93e484a27411c1b1b8ec4ecda31152">iMode</a> = 0; 
        odPerformanceLevels-&gt;<a name="a36"></a><a class="code" href="structADLODNPerformanceLevelsX2.html#2e04234e415c9e4a91eef4d24b079346" title="Must be set to sizeof( ADLODPerformanceLevels ) + sizeof( ADLODPerformanceLevel )...">iNumberOfPerformanceLevels</a> = overdriveCapabilities.<a class="code" href="struct__ADLODNCapabilitiesX2.html#05acc64089a06ce6ccce380b071bde3c">iMaximumNumberOfPerformanceLevels</a>;
        iReturn = <a class="code" href="group__OVERDRIVEN.html#ga141830b2e41239d07fdbd12226ce654" title="Function to retrieve the current memory clocks settings.">ADL2_OverdriveN_MemoryClocksX2_Get</a>(context, lpAdapterInfo[i].iAdapterIndex, odPerformanceLevels);
        <span class="keywordtype">int</span> iDisplayIdx = 0;
        <a class="code" href="structADLMVPUStatus.html" title="Structure containing information about MultiVPU status.">ADLMVPUStatus</a> stMVPInfo_ADL = { 0 };
        stMVPInfo_ADL.<a name="a37"></a><a class="code" href="structADLMVPUStatus.html#e6575f0148d35bb33ce3a63b6343848f" title="Must be set to sizeof( ADLMVPUStatus ).">iSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structADLMVPUStatus.html" title="Structure containing information about MultiVPU status.">ADLMVPUStatus</a>);
        iReturn = pADL_Display_MVPUStatus_Get(iDisplayIdx, &amp;stMVPInfo_ADL);
    }
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>}

VOID ServiceStop()
{
    <span class="keywordflow">if</span> (hServerStopEvent)
        SetEvent(hServerStopEvent);
}


LPTSTR GetLastErrorText(LPTSTR lpszBuf, DWORD dwSize)
{
    DWORD dwRet;
    LPTSTR lpszTemp = NULL;

    dwRet = FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ARGUMENT_ARRAY,
        NULL,
        GetLastError(),
        LANG_NEUTRAL,
        (LPTSTR)&amp;lpszTemp,
        0,
        NULL);

    <span class="keywordflow">if</span> (!dwRet || ((<span class="keywordtype">long</span>)dwSize &lt; (<span class="keywordtype">long</span>)dwRet + 14))
        lpszBuf[0] = TEXT(<span class="charliteral">'\0'</span>);
    <span class="keywordflow">else</span>
    {
        <span class="keywordflow">if</span> (NULL != lpszTemp)
        {
            lpszTemp[lstrlen(lpszTemp) - 2] = TEXT(<span class="charliteral">'\0'</span>);  
        }
    }

    <span class="keywordflow">if</span> (NULL != lpszTemp)
        LocalFree((HLOCAL)lpszTemp);

    <span class="keywordflow">return</span> lpszBuf;
}

BOOL CheckIsVista()
{
        OSVERSIONINFO   VerInfo;
        VerInfo.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVERSIONINFO);
        GetVersionEx(&amp;VerInfo);

        <span class="keywordflow">if</span> (VerInfo.dwPlatformId == VER_PLATFORM_WIN32_NT)
        {
                <span class="keywordflow">if</span> ((VerInfo.dwMajorVersion == 6) &amp;&amp; (VerInfo.dwMinorVersion &gt;= 0))
                {
                        <span class="keywordflow">return</span> TRUE;
                }
        }
        <span class="keywordflow">return</span> FALSE;
}
</pre></div> </div>
<hr size="1"><div  style="text-align: right;"><small>Copyright &copy 2009-2016 Advanced Micro Devices, Inc. All rights reserved.&nbsp;
<a href="http://developer.amd.com"><img src="53863A_AMD_E_Blk_RGB.PNG" title="developer.amd.com" align="middle" border="0" height="10px"></a></small></div>
</body>
</html>
